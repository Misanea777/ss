using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Windows.Forms;
using VulnerabilityScanner.Frontend;

namespace VulnerabilityScanner
{
    public partial class Form1 : Form
    {
        Controller controller;
        ImportForm importForm;
        public Form1(Controller controller)
        {
            this.controller = controller;
            importForm = new ImportForm(controller, this);
            InitializeComponent();
            policiesTreeView.CheckBoxes = true;

            controller.updatePolicyComBox(policiesComboBox);

            setCustomization();
        }

        private void setCustomization()
        {
            policiesTreeView.BackColor = Color.AntiqueWhite;
        }



        private void policiesComboBox_SelectionChangeCommitted(object sender, EventArgs e)
        {
            policiesTreeView.Nodes.Clear();
            string name = policiesComboBox.SelectedItem.ToString() + ".xml";
            controller.getPoliciesfromXml(name);
            controller.displayPolicies(controller.currentPolicies, policiesTreeView);
        }

        private void addButton_Click(object sender, EventArgs e)
        {
            if(importForm.IsDisposed)
            {
                importForm = new ImportForm(controller, this);
            }
            importForm.Show();
        }

        public ComboBox getPolicyComBox() { return policiesComboBox; }

        private void searchTextBox_TextChanged(object sender, EventArgs e)
        {
            controller.displayPolicies(controller.getListFromSearch(searchTextBox.Text), policiesTreeView);
        }

        private void scanButton_Click(object sender, EventArgs e)
        {
            controller.scan(controller.currentPolicies);
            controller.displayPolicies(controller.currentPolicies, policiesTreeView);
        }
    }
}
